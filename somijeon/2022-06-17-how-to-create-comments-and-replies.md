# ğŸ’¡ ë¹„ì „ê³µìì—ê²Œ ë‚´ìƒˆë¼(ë‚˜ì˜ ì½”ë”©) ì„¤ëª…í•˜ê¸° ì‹œë¦¬ì¦ˆ 1ï¸âƒ£ â€” ëŒ“ê¸€ê³¼ ë‹µê¸€

## - ëŒ“ê¸€ê³¼ ëŒ€ëŒ“ê¸€ ë’¤ì— ìˆ¨ì–´ìˆëŠ” í”¼, ë•€, ëˆˆë¬¼(feat. BTS)

### 1. ëŒ“ê¸€ì˜ ê¸°ë³¸ êµ¬ì„±

<img width="244" alt="commentSchema" src="https://user-images.githubusercontent.com/79065544/174426748-f2b0d0f8-0831-4235-b8e9-b750452f9ff3.png">

- `id`: ê°ê°ì˜ ëŒ“ê¸€ì€ ëª¨ë‘ ë°ì´í„°ë² ì´ìŠ¤ ì•ˆì—ì„œ ê³ ìœ í•œ ì•„ì´ë””ë¥¼ ê°€ì§€ì§€. ì‚¬ìš©ìì˜ ê³ ìœ í•œ ì•„ì´ë””ë§Œ ìˆë‹¤ë©´ ê·¸ ì‚¬ëŒì˜ ëª¨ë“  ëŒ“ê¸€ê¹Œì§€ êµ³ì´ ì•„ì´ë””ê°€ ìˆì–´ì•¼ í• ê¹Œ? ë¼ê³  ìƒê°í•  ìˆ˜ë„ ìˆì–´. í•˜ì§€ë§Œ ëª¨ë“  ëŒ“ê¸€ì˜ ì•„ì´ë””ê°€ ê³ ìœ í•˜ì§€ ì•Šê³  ì¤‘ë³µë˜ëŠ” ì•„ì´ë””ê°€ ìˆê±°ë‚˜ í•˜ë©´ íŠ¹ì • ëŒ“ê¸€ì˜ ìˆ˜ì •ì´ë‚˜ ì‚­ì œë¥¼ ëˆŒë €ì„ ë•Œ ì—„í•œ ëŒ“ê¸€ì´ ì‚­ì œë  ìˆ˜ë„ ìˆì–ì•„? ê·¸ë˜ì„œ ëª¨ë“  ëŒ“ê¸€ì€ ì•„ì´ë´í‹°í‹°ê°€ í•„ìš”í•´.
- `userId`: ì–´ë–¤ ì‚¬ìš©ìê°€ ì“´ ëŒ“ê¸€ì¸ì§€ ë‹¹ì—°íˆ ì•Œ ìˆ˜ ìˆì–´ì•¼ ê² ì§€. ë³´í†µ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„ì´ë‚˜ í”„ë¡œí•„ ì‚¬ì§„, ê°œì¸ ì •ë³´ ë“±ì„ ëª¨ì•„ë†“ì€ ë°ì´í„°ë² ì´ìŠ¤ê°€ ìˆê¸° ë§ˆë ¨ì´ê³  ìš°ë¦¬ëŠ” ê·¸ ì •ë³´ë¥¼ ëŒì–´ ì™€ì„œ ëŒ“ê¸€ì˜ ê³ ìœ í•œ ì•„ì´ë””ì™€ ì§ì§€ì–´ ë†“ëŠ” ê±°ì•¼.
- `postId`: ëŒ“ê¸€ë§Œ ë©ê·¸ëŸ¬ë‹ˆ ìˆëŠ” ê²½ìš°ëŠ” ì—†ì§€? ë³´í†µ ì‚¬ì§„ì´ë‚˜ ê¸€ì˜ í¬ìŠ¤íŒ… ì•„ë˜ ë‹¬ë¦¬ë‹ˆê¹Œ ì´ ëŒ“ê¸€ì´ ì–´ë–¤ í¬ìŠ¤íŒ…ì— ë‹¬ë¦° ê²ƒì¸ì§€ ê·¸ í¬ìŠ¤íŒ…ì˜ ê³ ìœ í•œ ì•„ì´ë””ë„ ì•Œì•„ì•¼ í•˜ì§€.
- `content`: ì´ê²Œ ìš°ë¦¬ê°€ ìƒê°í•˜ëŠ” ëŒ“ê¸€ì˜ ë‚´ìš©ì´ì§€.
- `createdAt`, `updatedAt`: ëŒ“ê¸€ì´ ì–¸ì œ ë‹¬ë ¸ê³  ì–¸ì œ ìˆ˜ì •ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ìˆì–´ì•¼ê² ì§€?

### 2. ëŒ€ëŒ“ê¸€ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì£¼ëŠ” ë§ˆë²•

- `parentId`: ëŒ€ëŒ“ê¸€ì´ ì•„ë‹Œ ì¼ë°˜ ëŒ“ê¸€ì€ `parentId`ê°€ `null`(ì—†ìŒ)ì´ì•¼. ê·¸ëŸ°ë° ë§Œì•½ ëŒ€ëŒ“ê¸€ì´ ë‹¬ë¦°ë‹¤ë©´? ì´ ëŒ€ëŒ“ê¸€ì€ ëŒ“ê¸€ì²˜ëŸ¼ ê³ ìœ í•œ ì•„ì´ë””ë¥¼ ê°€ì§ê³¼ ë™ì‹œì— parentIdë¼ëŠ”ê²Œ ì£¼ì–´ì§€ì§€. í•œ ë§ˆë””ë¡œ ëŒ€ëŒ“ê¸€ì€ ìì‹ì´ê³  ëŒ€ëŒ“ê¸€ì„ ì£¼ë ì£¼ë  ë‹¬ê³  ìˆëŠ” ëŒ“ê¸€ì€ ë¶€ëª¨ë‹˜ì´ë¼ëŠ” ê±°ì•¼. ë¶€ëª¨ë‹˜ì˜ ê³ ìœ í•œ ì•„ì´ë””ë¥¼ ëŒ€ëŒ“ê¸€ì´ í’ˆê³  ìˆëŠ” ê±°ì§€. ë“±ë³¸ ë–¼ë©´ ë¶€ëª¨ë‹˜ ì´ë¦„ì´ ë‚˜ì˜¤ëŠ” ê²ƒì²˜ëŸ¼!
  
### 3. ìˆ˜ì •ê³¼ ì‚­ì œëŠ” ì•„ë¬´ë‚˜ í•˜ë‚˜

- `user.id === comment.userId`: ë‚´ê°€ ì“´ ëŒ“ê¸€ì—ë§Œ ìˆ˜ì •ê³¼ ì‚­ì œ ë²„íŠ¼ì´ ë³´ì—¬ì•¼ê² ì§€? ê´€ë¦¬ìë„ ì•„ë‹Œë° ë‹¤ë¥¸ ì‚¬ëŒ ëŒ“ê¸€ë„ ë‚´í‚¤ëŠ” ëŒ€ë¡œ ì‚­ì œí•  ìˆ˜ ìˆë‹¤ë©´ ëŒ“ê¸€ì´ ë‚œë¦¬ê°€ ë‚˜ê² ì§€. ê·¸ë˜ì„œ ëŒ“ê¸€ì´ ê°€ì§€ê³  ìˆëŠ” ìœ ì €ì˜ ì •ë³´ê°€ í˜„ì¬ ë¸Œë¼ìš°ì €ë¥¼ ì§€ì¼œë³´ê³  ìˆëŠ” ìœ ì €ì™€ ê°™ì€ ì‚¬ëŒì¸ì§€ íŒë³„í•˜ê³  ê·¸ì— ë”°ë¼ ë³¼ ìˆ˜ ìˆëŠ” ë²„íŠ¼ì´ ë‹¬ë¼ì ¸ì•¼ í•´. ìŠ¤í¬ë¦°ìƒ·ì„ ë³´ë©´ ë‚´ê°€ ì“°ì§€ ì•Šì€ ëŒ“ê¸€ì—ëŠ” ë‹µê¸€ ë²„íŠ¼ë§Œ ìˆê³  ë‚´ê°€ ì‘ì„±í•œ ëŒ“ê¸€ì—ëŠ” ë‹µê¸€, ìˆ˜ì •, ì‚­ì œ 3ê°€ì§€ê°€ ë³´ì´ì§€? ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ë˜ ìˆ˜ì •ê³¼ ì·¨ì†Œë¼ëŠ” ë²„íŠ¼ì´ ìƒˆë¡œ ìƒê¸°ì§€. ì‚¬ìš©ìê°€ ë„ëŒ€ì²´ ë­˜ í•˜ë ¤ê³  í•˜ëŠ” ì§€ ì§‘ìš”í•˜ê²Œ ë”°ë¼ë¶™ì–´ ì •í™•í•œ ë²„íŠ¼ì„ ë³´ì—¬ì¤˜ì•¼ í•˜ëŠ” ê³ ë…í•œ ì‹¸ì›€ì´ì•¼.

### 4. ëŒ“ê¸€ ì‘ì„± í™œì„± ìƒíƒœ

- `activeComment` or not?: ëŒ“ê¸€ì„ ì‘ì„±í•˜ëŠ” ë¶„í™ìƒ‰ ì…ë ¥ì°½ì´ ëŒ“ê¸€ì´ë‚˜ ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ” ê³³ë§ˆë‹¤ ì—´ë¦¬ê³  ëŒ“ê¸€ ì‘ì„±ì´ ì™„ë£Œëœ í›„ì—ë„ ì—´ë ¤ìˆë‹¤ê³  ìƒê°í•´ ë´. ëª‡ ë²ˆ í´ë¦­í•˜ë‹¤ ë³´ë©´ ê²°êµ­ì—” ë¶„í™ìƒ‰ ë„¤ëª¨ê°€ ë„ˆë¬´ ë§ì•„ì ¸ì„œ ë³´ê¸° ì¢‹ì§€ ì•Šì„ ê±°ì•¼. ê·¸ë˜ì„œ í™œì„± ì…ë ¥ì°½ì€ í•œë²ˆì— í•˜ë‚˜ë§Œ ì—´ë¦¬ê²Œ í•´ë’€ì–´. ì²« ë²ˆì§¸ ëŒ“ê¸€ì— ë‹µê¸€ ë²„íŠ¼ì„ ëˆŒë €ë‹¤ê°€ ë‹¤ë¥¸ ëŒ“ê¸€ì— ë‹µê¸€ì„ ë‹¬ê¸°ë¡œ ë§ˆìŒì„ ë°”ê¾¸ë©´ ìœ„ì˜ í™œì„±ì°½ì€ ë‹«íˆê³  ì•„ë˜ì— ìƒˆë¡œ ì—´ë¦¬ëŠ” ê±°ì•¼. ëŒ“ê¸€ ì‘ì„±ì´ ì™„ë£Œë˜ë©´ ë‹¹ì—°íˆ ë¶„í™ í™œì„±ì°½ì´ ì—†ì–´ì§€ê³  ìƒˆë¡œìš´ ëŒ“ê¸€ë§Œ ë³´ì—¬ì£¼ê³  ë§ì•¼.

### 5. ì¬ê¹ì¬ê¹ ì—…ë°ì´íŠ¸

- ìƒˆë¡œìš´ ì •ë³´ê°€ ì…ë ¥, ìˆ˜ì •, ì‚­ì œë˜ë©´ ê·¸ê±¸ ë°±ì—”ë“œë¼ ë¶ˆë¦¬ëŠ” ë¯¸ì§€ì˜ ì„¸ê³„ ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë„˜ê²¨ì¤Œê³¼ ë™ì‹œì— ë¸Œë¼ìš°ì €ì— ìƒˆ ì •ë³´ê°€ ì—…ë°ì´íŠ¸ê°€ ë˜ì–´ì•¼ í•˜ì§€. ìš°ë¦¬ëŠ” ëª¨ë¥´ì§€ë§Œ GET/PATCH/DELETEë¼ëŠ” ìš”ì²­ê³¼ ì‘ë‹µì´ ëŠì„ì—†ì´ ì˜¤ê°€ì•¼ë§Œ í™”ë©´ì´ ì—…ë°ì´íŠ¸ ë˜ëŠ” ê±°ì•¼. ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ” ë™ì•ˆ ë‹¹ì‹ ì˜ ê¸°ë‹¤ë¦¼ì„ ëœ ì§€ë£¨í•˜ê²Œ í•  ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ë„ ë„ì›Œì£¼ê³ ... ì°¸ ì¹œì ˆí•˜ë‹¤ ì¹œì ˆí•´!  


> ë‹¤ìŒ ì´ì•¼ê¸°
ë¬´ì–¸ê°€ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì‚­ì œí•  ë•Œ ì¼ì¼ì´ ëœ¨ëŠ” í™•ì¸ì°½ì„ ë§Œë“œëŠ” ê²ƒì—ë„ ë‹¹ì‹ ì˜ ìƒê°ë³´ë‹¤ ë³µì¡í•œ ë¯¸í•™ì´ ìˆ¨ì–´ìˆë‹¤ëŠ” ì‚¬ì‹¤!


> íŠ¹ì • ìœ ì €ê°€ ê²Œì‹œê¸€ì„ ë‚¨ê¸¸ ë•Œ í˜¹ì€ ê²Œì‹œê¸€ì— ëŒ€í•œ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ë•Œ ì„œë²„ì—ì„œëŠ” ìœ ì €ì˜ ì–´ë– í•œ ì •ë³´ë“¤ì„ ìˆ˜ì§‘í•  ìˆ˜ ìˆì„ê¹Œìš”?
> ì˜ˆë¥¼ ë“¤ì–´, ì–´ë–¤ ì‹¸ì´íŠ¸ì—ì„œëŠ” ê²Œì‹œê¸€ í˜¹ì€ ëŒ“ê¸€ì„ ì‘ì„±í•œ ì‚¬ëŒì˜ IPê°€ ìë™ìœ¼ë¡œ ë…¸ì¶œë˜ê²Œë” ë˜ì–´ìˆê³ , ë˜ ì–´ë–¤ ì‹¸ì´íŠ¸ëŠ” IPê°€ ê³µê°œê°€ ì•ˆë˜ëŠ”ë°ìš”. ì´ë¥¼ í†µí•´ì„œ ì¶”ì •í•´ë³¼ ë•Œ, ê¸°ë³¸ì ìœ¼ë¡œ ìœ ì €ê°€ ëŒ“ê¸€ì„ ë‚¨ê¸¸ ë•Œ IPì •ë³´ê°€ ì–´ë– í•œ í˜•íƒœë¡œë“  ì„œë²„ì¸¡ì— ì œê³µì´ ë¨ì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ëŠ” ìœ ì € ì‚¬ì´ë“œì—ì„œëŠ” ë³„ë„ë¡œ ì„¤ì •ì„ í•˜ì§€ ì•Šì•˜ìŒì—ë„ ê°•ì œì ìœ¼ë¡œ ì§„í–‰ì´ ë˜ë”ë¼êµ¬ìš”.


ê·¸ë¦¬ê³  IP ì™¸ì— ì„œë²„ëŠ” íŠ¹ì • ìœ ì €ì˜ ì–´ë– í•œ ì •ë³´ë“¤ì„ í•©ë²•ì (!)ìœ¼ë¡œ ìˆ˜ì§‘í•  ìˆ˜ ìˆì„ê¹Œìš”? ê·¸ì € ë‹¨ìˆœí•˜ê²Œ ì˜ˆë¥¼ ë“¤ì–´ ìƒê°í•˜ë©´, ì„œë²„ì— ì ‘ì†í•  ë•Œ ì„œë²„ ë‹¨ì—ì„œ ìœ ì €ì˜ í¬ë¡¬ ë¸Œë¼ìš°ì € ìƒì— ë“±ë¡ë˜ì–´ìˆëŠ” ì¦ê²¨ì°¾ê¸° ëª©ë¡ì„ ìš”ì²­í•´ì„œ ë°›ëŠ”ë‹¤ê±°ë‚˜, í˜„ì¬ ì‹œìŠ¤í…œì— ë¬¼ë ¤ìˆëŠ” í•˜ë“œì›¨ì–´ ëª©ë¡ì„ ë°›ëŠ” ë‹¤ê±°ë‚˜, í˜¹ì€ OSì— ì„¤ì¹˜ë˜ì–´ ìˆëŠ” í”„ë¡œê·¸ë¨ì˜ ë¦¬ìŠ¤íŠ¸ë¥¼ ì¶”ì¶œí•˜ëŠ” ê²ƒë„ ê°€ëŠ¥í•  ê²ƒ ê°™ë‹¤ëŠ” ìƒê°ì´ ë“­ë‹ˆë‹¤. ë¬¼ë¡  í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë°©í™”ë²½ì´ë‚˜ ì ‘ê·¼ ê¶Œí•œì„ í†µí•´ ì œí•œì„ í•˜ê² ì§€ë§Œìš”. ìƒê°í•´ë³´ë©´ ì´ê²ƒì´ ìˆœìˆ˜í•˜ê²Œ í´ë¼ì´ì–¸íŠ¸ë§Œì˜ ë³´ì•ˆ ì˜ì‹ ë¬¸ì œë¡œ ì¹˜ë¶€í•˜ê¸°ì—ëŠ” ë¦¬ìŠ¤í¬ê°€ ë„ˆë¬´ ë§ì§€ ì•Šë‚˜ í•˜ëŠ” ìƒê°ì´ ë“¤ì–´ì„œìš”.

ìœ„ì˜ ìƒê°ì„ ì¡°ê¸ˆ ë” í™•ì¥í•´ë³´ë©´, ëˆ„êµ°ê°€ì— ì˜í•´ ì•…ì˜ì ìœ¼ë¡œ ëŒ“ê¸€ ì‘ì„±ì„ í†µí•œ í•´í‚¹ ì‹œë„ë„ ê°€ëŠ¥í•˜ë¦¬ë¼ ìƒê°ì´ ë©ë‹ˆë‹¤. ëŒ“ê¸€ ì‘ì„±ì„ í•˜ê³  ë‚˜ì„œ í™•ì¸ ì°½ì´ ëœ¨ëŠ” ê²½ìš°, ê·¸ í™•ì¸ ë²„íŠ¼ì— ìˆ¨ê²¨ì§„ ì½”ë“œë¥¼ ë§í¬í•˜ê³ , í™•ì¸ ë²„íŠ¼(ì´ë¼ ì“°ê³  ê¶Œí•œ ì œê³µ ë™ì˜ ë²„íŠ¼ì´ë¼ ì½ìŒ..)ì„ ëˆ„ë¥´ëŠ” ìˆœê°„, ê¶Œí•œì„ íƒˆì·¨í•˜ê³  ì •ë³´ë¥¼ ë¹¼ê°ˆ ìˆ˜ë„ ìˆì§€ ì•Šì„ê¹Œ ì‹¶ìŠµë‹ˆë‹¤. ë¬¼ë¡ , ì´ê²ƒì€ ê·¸ì € ì´ˆë³´ì ì¸ ìƒê°ì´ë¼ ë¸Œë¼ìš°ì € ì¸¡ì—ì„œ ê°ì§€í•˜ê³  ì‚¬ì „ì— ì°¨ë‹¨ì„ í•  ìˆ˜ë„ ìˆì„ ê²ƒ ê°™ê¸°ë„ í•©ë‹ˆë‹¤.


ì‚¬ì‹¤ ì €í¬ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë”±íˆ IP ì£¼ì†Œë¥¼ DBì— ì €ì¥í•´ë†“ê³  ê·¸ê±¸ ì‚¬ìš©ìë¥¼ ì‹ë³„í•˜ê±°ë‚˜ í•˜ëŠ”ë° ì‚¬ìš©í•˜ì§€ëŠ” ì•Šì•„ì„œ ê¹Šê²Œ ìƒê°í•´ë³´ì§„ ì•Šì•˜ëŠ”ë° ê²€ìƒ‰í•´ë³´ë‹ˆ ë§ì”€í•˜ì‹  ê²ƒì²˜ëŸ¼ ì„œë²„ë¡œ ë³´ë‚´ëŠ” ëª¨ë“  ìš”ì²­ì€ ì‚¬ìš©ìì˜ ë™ì˜ ì—¬ë¶€ì™€ ìƒê´€ì—†ì´ IP ì£¼ì†Œë¥¼ í¬í•¨í•˜ê³  ìˆëŠ” ê²ƒ ê°™ì•„ìš”. ê·¸ëŸ°ë° IP ì£¼ì†Œë¼ëŠ”ê²Œ ê³µìš© ì£¼ì†Œë„ ìˆê³  ì•„ì£¼ ë¯¼ê°í•œ ì •ë³´ ê°™ì§€ëŠ” ì•Šì•„ì„œ í¬ê²Œ ê±±ì •ì€ ì•ˆ í–ˆëŠ”ë° ì•…ìš©í•˜ë ¤ëŠ” ë§ˆìŒì„ ë¨¹ìœ¼ë©´ ë˜ ì–´ë–»ê²Œ ì“°ì¼ ì§€ ì•Œ ê¸¸ì´ ì—†ìœ¼ë‹ˆ... ê±±ì •í•˜ì‹œëŠ” ë§ˆìŒë„ ì´í•´ê°€ ê°‘ë‹ˆë‹¤.

ì €í¬ëŠ” JSON Web Tokenì„ ì´ìš©í•´ ì‚¬ìš©ìê°€ íšŒì›ê°€ì…ì„ í•  ë•Œ ì…ë ¥í•œ ìœ ì €ë„¤ì„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¥¼ ìˆ˜ì§‘í–ˆê³  ìœ ì €ë„¤ì„, ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¡œ ìƒì„±í•œ í† í°ì„ ì¿ í‚¤ì— ì‹¤ì–´ ë³´ë‚´ëŠ”ë° ì‚¬ì‹¤ ì´ ê²½ìš° XSS ê³µê²©ì„ í†µí•´ í˜ì´ì§€ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ íšë“í•´ ì •ìƒ ì‚¬ìš©ìì¸ì²™ í•  ìœ„í—˜ì´ ìˆê¸°ëŠ” í•©ë‹ˆë‹¤. ã… ã…  ê·¸ë˜ì„œ ì €í¬ëŠ” bcryptë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì•”í˜¸í™”í•´ì„œ í† í°ì„ ìƒì„±í•˜ê¸°ëŠ” í•©ë‹ˆë‹¤.

ê²€ìƒ‰í•´ë³´ë‹ˆ IP Address bound JWTë¼ëŠ” ê²ƒë„ ìˆì–´ì„œ ì‚¬ìš©ìì˜ IPì£¼ì†Œì™€ í† í°ì„ ì—°ê²°í•´ ë†“ê¸°ë„ í•˜ë”ë¼ê³ ìš”. ([ë ˆí¼ëŸ°ìŠ¤](https://medium.com/@adarsh.pradyut/ip-bound-jwt-6e2669d15391)) ê·¸ëŸ¬ë©´ í™•ì‹¤íˆ ë¶ˆëª…í™•í•œ í•´ì™¸ì˜ ì–´ëŠ IP ì£¼ì†Œë¡œ ë¡œê·¸ì¸í•´ì„œ ì‚¬ìš©ìì˜ ì •ë³´ë¥¼ íƒˆì·¨í•  ìˆ˜ëŠ” ì—†ê² ì§€ë§Œ ëª¨ë°”ì¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê²½ìš° WiFië‚˜ ë°ì´í„°ë¡œ ì ‘ì†í• ë•Œë§ˆë‹¤ IP ì£¼ì†Œê°€ ë°”ë€Œê²Œ ë˜ë‹ˆ í•˜ë‚˜ì˜ ì£¼ì†Œë§Œ ì—°ê²°í•´ ë†“ìœ¼ë©´ ë‚˜ì¤‘ì— ë¡œê·¸ì¸ì´ ì•ˆ ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•  ìˆ˜ë„ ìˆì–´ì„œ ë„ì…ì´ ì •ë§ í•„ìš”í•œ ì§€ ë”°ì ¸ë´ì•¼ í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.

í¬ìŠ¤íŒ…ì´ë‚˜ ëŒ“ê¸€ì— ì•…ì„± ì½”ë“œë¥¼ ì¶”ê°€í•´ì„œ DBì— ì €ì¥í•˜ê²Œë” í•˜ê³  ê·¸ê²ƒì´ ë¸Œë¼ìš°ì €ì— ë³´ì—¬ì§€ëŠ” ê²½ìš°ëŠ” ì™•ì™• ìˆì–´ì„œ ì½”ë“œë¥¼ ì§¤ ë•Œ ì›¬ë§Œí•˜ë©´ innderHTML ëŒ€ì‹ ì— textContentë¥¼ ì‚¬ìš©í•˜ë¼ê³  ë°°ì› ì–´ìš”. ê·¸ëŸ¬ë©´ ì´ìƒí•œ ìŠ¤í¬ë¦½íŠ¸ë“¤ì´ ê·¸ëƒ¥ stringìœ¼ë¡œ íŒŒì‹±ë˜ê±°ë“ ìš”. ê·¸ê²ƒë§ê³ ë„ HTTP ëŒ€ì‹  HTTPSë¥¼ ì‚¬ìš©í•œë‹¤ë˜ê°€ CSPë¥¼ ì‚¬ìš©í•œë‹¤ë˜ê°€ ë§ì€ ë°©ë²•ì´ ìˆë”ë¼ê³ ìš”. ì§ˆë¬¸í•´ì£¼ì‹  ë•ë¶„ì— ì•ˆì „í•œ ì›¹ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•´ ë” ê³µë¶€í•´ë´ì•¼ê² ë‹¤ëŠ” ì˜ì§€ê°€ ìƒê²¼ìŠµë‹ˆë‹¤!


---

activeCommentëŠ” Bool íƒ€ì…ì€ ì•„ë‹ˆê³  ì´ˆê¸° ìƒíƒœëŠ” null ì´ê³  ë‚˜ì¤‘ì— ê°ì²´íƒ€ì…ì˜ ì¸ìë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. ë³´ì„±ë‹˜ì˜ ë§ì”€ì²˜ëŸ¼ ë¸Œë¼ìš°ì € client side jsì— ìˆì–´ìš”!

1. ë¦¬ë•ìŠ¤ íˆ´í‚· ìŠ¬ë¼ì´ìŠ¤ì— ì‚¬ìš©ì ì •ë³´ê°€ ìˆê³  parentIdê°€ ì—†ëŠ” ê²½ìš°ì—ë§Œ ë‹µê¸€ì„ ë‹¬ ìˆ˜ ìˆë‹¤ê³  ì •í•´ ë†“ì•˜ì–´ìš”. 
2. `onClick`ì— `setActiveComment`ë¡œ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ í•©ë‹ˆë‹¤. 
3. ì´ì œ  `activeComment`ê°€ ë”ì´ìƒ null ì´ ì•„ë‹ˆë‹ˆ `isReplying` ì¡°ê±´ë„ ì¶©ì¡±ì´ ëœë‹¤ë©´ ëŒ“ê¸€ì„ `submit`í•  ìˆ˜ ìˆì–´ìš”.
4. ê·¸ë¦¬ê³  `addComment`ê°€ ì‹¤í–‰ë˜ë©´ ê·¸ ì•ˆì— ë‹¤ì‹œ `setActiveComment(null)` ê°€ í˜¸ì¶œë˜ì–´ ë¶„í™ í™œì„±ì°½ì´ ì—†ì–´ì§€ê²Œ ë©ë‹ˆë‹¤.

```js
const { user } = useSelector((state) => state.user);

const [activeComment, setActiveComment] = useState(null);

const canReply = Boolean(user?.id) && !comment.parentId;

{canReply && ( 
  <CommentAction
    type="button"
    onClick={() => setActiveComment({ id: comment.id, type: "replying" })}
>ë‹µê¸€
</CommentAction>
)}

const isReplying =
  activeComment && activeComment.id === comment.id && activeComment.type === "replying";

{isReplying && (
  <CommentForm
    commentId={comment.id}
    studyId={comment.study_id}
    replyId={replyId}
    submitLabel="ì‘ì„±"
    handleSubmit={addComment}
  />
)}

const addComment = async (commentData) => {
  await dispatch(writeComment(commentData));
  setActiveComment(null);
};

```

